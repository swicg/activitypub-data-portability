<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Data Portability in ActivityPub</title>
    <script
      src="https://www.w3.org/Tools/respec/respec-w3c"
      class="remove"
      defer
    ></script>
    <script class="remove">
      // All config options at https://respec.org/docs/
      var respecConfig = {
        specStatus: "CG-DRAFT",
        editors: [{ name: "Evan Prodromou", url: "https://evanp.me/" }],
        github: "swicg/activitypub-data-portability",
        latestVersion: "https://swicg.github.io/activitypub-data-portability/",
        shortName: "data-portability-report",
        group: "socialcg",
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>This document describes data portability in ActivityPub.
        It lists what data exists for an actor. It then describes two modes of data
        portability for an actor: using a domain, and Mastodon-style <code>Move</code>.
      </p>
    </section>

    <section id="sotd">
        <p>This is a draft of a future SocialCG report.</p>
      </section>
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        Data portability is the ability of a user to move their data from one
        system to another system. This includes moving between ActivityPub
        implementations, moving to different installations of the same
        software, or changing domains.
      </p>
    </section>

    <section class="informative">
      <h2>Core Concepts</h2>

      <section class="informative">
        <h3>Objects and Activities</h3>

        <p>
          The basic unit of data for the ActivityPub protocol is an
          <a href="https://www.w3.org/TR/activitypub/#obj">ActivityPub Object</a>,
          a structured (JSON) document with a set of required and optional
          properties. The core set of properties are defined in the
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-object">ActivityStreams 2</a>
          data model specification, and ActivityPub adds a couple of additional
          requirements (namely, that all objects must have a <code>type</code>
          property, as well as a globally unique <code>id</code> that serves as
          that object's location).
        </p>
        <p>
          In terms of data migration and portability, objects by themselves
          are very simple: because an object's <code>id</code> serves as its
          location (as specified in
          <a href="https://w3c.github.io/activitypub/#obj-id">ActivityPub Section 3.1</a>),
          the process of moving an object is as simple as transporting it (by any
          appropriate protocol), and updating its <code>id</code> property to
          its new location.
        </p>
        <p>
          However, in the context of ActivityPub use cases, objects are rarely
          encountered by themselves, in isolation. Because ActivityPub
          is a protocol intended for building distributed social systems, it has
          two important design aspects: one, authorship and provenance are
          important, and two, objects are not intended to be created or mutated
          directly, but are instead wrapped in lifecycle Activities (such as
          <code>Create</code>, <code>Update</code>, <code>Delete</code>, and
          others). In distributed system design, this is known as the Event
          Sourcing pattern, where the state of each object is not stored directly,
          but is instead constructed from a series of actions taken on the object.
          The fact that these are social systems brings additional challenges:
          the series of Actions are always attributed to (performed by) a
          particular <a>Actor</a>. Also, these Actions typically have an intended
          audience, which means that for any state change the object undergoes,
          there may exist any number of stakeholders who must be informed about
          those changes.
        </p>
        <p>
          Taken together, the design aspects of the ActivityPub protocol present
          non-trivial challenges, when it comes to data migration and portability.
          Objects are rarely encountered by themselves, in isolation. Instead, they
          exist as an append-only series of Actions, each performed by an
          Actor, within a social context (each action typically has intended
          audiences, as well as other observers and stakeholders).
          And because of that, moving an object means not only updating its
          <code>id</code> to a new location, but it also means preserving its
          chain of actions, authorship, full social context, and often also
          notifying all interested (authorized) observers of the move.
        </p>
      </section>

      <section class="informative">
        <h3>ActivityPub Actor Identity</h3>

        <p>
          The <a href="https://www.w3.org/TR/activitypub/">ActivityPub 1.0 Specification</a>
          was intentionally silent on the subject of <a>actor</a> identity,
          authentication and authorization, leaving those up to <a>server</a>
          implementers. Multiple implementations arose that modeled <a>actors</a>
          as traditional user accounts, which controlled various types of data,
          such as contents (posts, notes, comments, images, etc), reactions
          (likes, reposts), related data such as bookmarks, social graphs (lists
          of followers and following users), actor metadata, moderation decisions
          (block lists, mutes), and more.
        </p>
        <p>
          Current implementations are oriented around three main aspects of
          actor identity:
        </p>
        <ol>
          <li>The actor's <code>id</code> which (as with other ActivityPub objects)
            must be a fetch-able URL. The <code>id</code> is typically used as
            the canonical identifier for the actor
          </li>
        </ol>

        <p>
          - data migration basically always means migration of a given <a>actor</a>
            first, followed by all of the data and metadata that the actor controls.
          - complex mapping between Actor and users -- some Actors are controlled
            by multiple users, and some users can have many Actors.
          - discuss the 3 aspects of an Actor's identity: actor id (url),
            actor webfinger identity, cryptographic material.
        </p>
      </section>

      <section class="informative">
        <h3>Instance Oriented Architecture</h3>

        <p>
          - for various historical reasons, ActivityPub implementations have
            centered around the concept of <a>Instances</a>.
          - this is not inherent in the ActivityPub protocol, but is an arbitrary
            set of design choices, a historical artifact
          - instances bundle together several key functions (which could be
            separated, in theory):
            1. Identity
            2. Storage
            3. Inbox/Outbox delivery, event subscriptions
            4. Moderation
            5. Community discovery
          - the fact that these functions are bundled together makes portability
            and migration even more challenging.
        </p>
      </section>

      <section class="informative">
        <h3>Data Portability, Migration, and Export</h3>

        <p>
          Data Portability, Migration, and Export / Backup, are separate but
          closely related concepts.
        </p>

        <section class="informative">
          <h4>Data Export / Backup (Data Model)</h4>

          <p>
            The ability to export all of the data for a given
            <a>actor</a> is helpful as an additional mechanism of data recovery,
            since it makes user-controlled backups possible (as opposed to server
            administrator controlled backups of backend databases, etc). And
            although the ability to export data, by itself, does not guarantee
            data portability (since many current implementations provide only
            export but not import functionality), having a well-defined and
            documented export format at least makes future import functionality
            possible.
          </p>
        </section>

        <section class="informative">
          <h4>Data Migration (Protocol)</h4>

          <p>
            In the context of this report, Data Migration is defined as the
            process of moving or copying
          </p>
        </section>
      </section>

      <section class="informative">
        <h3>Data Portability</h3>

        <p>
        </p>
      </section>
    </section>

    <section class="informative">
      <h2>Terminology</h2>

      <p>
        The following terms are used to describe concepts in this report.
      </p>

      <dl class="termlist">

        <dt><dfn data-lt="actor|actors">actor</dfn></dt>
        <dd>
          A conformant
          <a href="https://www.w3.org/TR/activitypub/#actors">ActivityPub Actor</a>.
        </dd>
        <dt><dfn data-lt="instance|instances">instance</dfn></dt>
        <dd>An informal name for an ActivityPub <a>server</a>, specifically,
          a particular instance of a given ActivityPub server implementation.
          In current implementations, instances are typically bound to a given
          URL / Web domain, which has implications for identity portability and
          data portability in general.
        </dd>
        <dt><dfn data-lt="server|servers">server</dfn></dt>
        <dd>
          An implementation of an <strong>ActivityPub conformant Server</strong>,
          as defined in
          <a href="https://www.w3.org/TR/activitypub/#specification-profiles">ActivityPub
            Specification Profiles</a>. <em>See also:</em> <a>instance</a>.
        </dd>
      </dl>
    </section>

    <section>
      <h2>Data elements</h2>
      <p>
        This is a list of data objects that are part of an actor's data.
      </p>
      <section id="own-server">
        <h3>On own server</h3>
        <p>
            <ul>
                <li>Actor ID (https URI)</li>
                <li>Webfinger identity</li>
                <li>Actor profile properties
                    <ul>
                        <li>name</li>
                        <li>avatar</li>
                        <li>content</li>
                        <li>links</li>
                        <li>URI</li>
                    </ul>
                </li>
                <li>Outbox
                    <ul>
                        <li>Activities</li>
                        <li>Reactions
                            <ul>
                                <li>replies</li>
                                <li>likes</li>
                                <li>shares</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>Inbox</li>
                <li>Uploaded files</li>
                <li>Followers</li>
                <li>Following</li>
                <li>Blocks</li>
                <li>public key</li>
            </ul>
          </p>
      </section>
      <section id="other-servers">
        <h3>Other servers</h3>
        <p>
            <ul>
                <li>ID in others' followers lists</li>
                <li>ID in others' following lists</li>
                <li>ID in others' blocked lists</li>
                <li>Links in @-mentions</li>
                <li>Object IDs for activities</li>
                <li>Object IDs for content</li>
                <li>URIs for uploaded files</li>
            </ul>
        </p>
      </section>

    </section>
    <section>
      <h2>Domain portability</h2>
      <p>
        This is a process for moving an actor from one ActivityPub server to another.
        It requires the user to run a server on a domain they control.
      </p>
      <section>
        <h3>Process</h3>
        <p>
            <ol>
                <li>The user backs up all data for the account at username@old.example.</li>
                <li>The user shuts down the old implementation running at old.example.</li>
                <li>The user installs the new implementation at old.example.</li>
                <li>The user restores all data to the account at username@old.example.</li>
            </ol>
        </p>
      </section>
      <section>
        <h3>Results</h3>
        <p>
            <ol>
                <li>All user data is available.</li>
                <li>All links from others' servers are still valid.</li>
            </ol>
        </p>
      </section>
      <section>
        <h3>Limitations</h3>
        <p>
            <ol>
                <li>No standard format for backup files exists; see https://github.com/w3c/activitypub/issues/370.</li>
                <li>The user has to register and maintain their own domain name.</li>
                <li>The user has to run their own server, or use a hosting service that allows mapping their own domain name.</li>
                <li>Different implementations may use different URI patterns for activities or content.</li>
            </ol>
        </p>
      </section>
    </section>
    <section>
        <h2>Move action</h2>
        <p>
            Mastodon and compatible server software use a <code>Move</code> activity
            to move an actor from one server to another.
        </p>
        <section>
            <h3>Process</h3>
            <p>The user will typically execute these steps using a Web interface or an API client, rather than executing them directly.</p>
            <p>
                <ol>
                    <li>The user creates a new actor at username@new.example</li>
                    <li>The user marks the new actor as accepting a move with the <code>alsoKnownAs</code> property.</li>
                    <li>The user marks the old actor as having moved with the <code>movedTo</code> property.</li>
                    <li>The user sends a <code>Move</code> activity from the old actor to all followers.
<pre class="json">
{
  "@context": "https://www.w3.org/ns/activitystreams",
  "type": "Move",
  "actor": "https://old.example/users/username",
  "object": "https://old.example/users/username",
  "target": "https://new.example/users/username"
}
</pre>
                    </li>
                    <li>Each follower checks the <code>alsoKnownAs</code> property of the new account and <code>movedTo</code> property of the old account.</li>
                    <li>Each follower sends a <code>Follow</code> activity to the new account.</li>
                    <li>Each follower sends an <code>Undo Follow</code> activity to the old account.</li>
                    <li>The old account's profile URI redirects to the new account's profile URI.</li>
                    <li>(Optional) The user exports the old account's <code>following</code> list as a CSV file.</li>
                    <li>(Optional) The user imports the CSV file into the new account.</li>
                    <li>(Optional) The new account sends a <code>Follow</code> activity to each account in the imported CSV file.</li>
                </ol>
            </p>
        </section>
        <section>
            <h3>Results</h3>
            <p>
                <ul>
                    <li>The old account's profile URI redirects to the new account.</li>
                    <li>The new account's followers is a subset of the old account's followers.</li>
                    <li>The new account's following is a subset of the old account's following.</li>
                    <li>The old account's followers list is empty.</li>
                    <li>Each follower's <code>following</code> list includes the ID of the new account.</li>
                </ul>
            </p>
        </section>
        <section>
            <h3>Limitations</h3>
            <p>
                <ul>
                    <li>The process will not work if the old account's server is down.</li>
                    <li>The process will not work if the old account's server is blocked by followers.</li>
                    <li>Content like images, videos, text, audio that are created in the old account is not moved to the new account.
                        If the old server goes down, all that content is lost.</li>
                    <li>Other user data listed above, like replies, likes, blocks are also not ported.</li>
                </ul>
            </p>
        </section>
      </section>
    <section id="changelog">
       <h2>Changelog</h2>
      <ul>
        <li>Added the limitation that a lot of data is not ported in the <code>Move</code> activity technique.</li>
        <li>Note that users will typically use software to make changes to their actor record or send activities.</li>
      </ul>
    </section>
    <section id="conformance">
      <p>
        This is required for specifications that contain normative material.
      </p>
    </section>
  </body>
</html>
